/* file minunit_example.c */
#include <stdio.h>
#include "../src/minunit.h"
#include "../src/flow.h"
#include "../src/OFsuite_handler.h"


struct parser_flow_mod pfm;
//
char flow_mod_message[104]={0x04,0x0e,0x00,0x68,0x00,0x10,0x03,0x99,0x00,0x0a,0x00,0x00,0x56,0x8c,0xbc,0xec,
						0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0a,
						0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x01,0x00,0x00,
						0x00,0x01,0x00,0x20,0x80,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x80,0x00,0x06,0x06,
						0x0a,0xb9,0x45,0xb2,0x89,0x6a,0x80,0x00,0x08,0x06,0x4e,0xa7,0xdf,0x4a,0x01,0xc5,
						0x00,0x04,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x01,
						0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};

void init_elements()
{
	//Init the flow mod message here
	//Messages from wireshark
	/*flow_mod_message = {0x04,0x0e,0x00,0x68,0x00,0x10,0x03,0x99,0x00,0x0a,0x00,0x00,0x56,0x8c,0xbc,0xec,
						0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0a,
						0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0xff,0x00,0x01,0x00,0x00,
						0x00,0x01,0x00,0x20,0x80,0x00,0x00,0x04,0x00,0x00,0x00,0x02,0x80,0x00,0x06,0x06,
						0x0a,0xb9,0x45,0xb2,0x89,0x6a,0x80,0x00,0x08,0x06,0xe2,0x89,0x1d,0xec,0x5b,0x43,
						0x00,0x04,0x00,0x18,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x01,
						0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00};*/

}

//struct flows* flows = init_flows();

static char* test_handle_flow_mod()
{
	
	pfm = parser_flow_mod_msg(flow_mod_message);
	printf("\n%d\n",ntohs(pfm.ofm.priority));
	//mu_assert(init_flows() != NULL, "Init failed");
	return NULL; 
}

static char* test_create_flow_entry()
{
	struct flow_entry* pfe = create_flow_entry(pfm);
	printf("\nflow_entry_priority:%d\n",ntohs(pfe->priority));
	printf("\nflow_entry_packet_count:%d\n",ntohs(pfe->packet_count));
	printf("\nmatch pointor content:%lu\n", (long)pfe->match);
	printf("\nmatch field:%d\n",(*(int*)pfe->match));
	flow_entry_print(pfe);
	return NULL;
}

static char* test_add_flow_entry()
{
	struct flows* flows = init_flows();
	struct flow_entry* pfe = create_flow_entry(pfm);
	mu_assert(add_flow_entry(flows, pfe) == 1, "add flow 1 failed");
	mu_assert(add_flow_entry(flows, pfe) == 2, "add flow 2 failed");
	mu_assert(add_flow_entry(flows, pfe) == 3, "add flow 3 failed");
	flow_entry_print(flows->flow_entry_head);
	flow_entry_print(flows->flow_entry_head->next_flow_entry);
	flow_entry_print(flows->flow_entry_head->next_flow_entry->next_flow_entry);
	return NULL;

}


 
 char *all_tests() 
 {
    mu_suite_start();
    init_elements();
    mu_run_test(test_handle_flow_mod);
    //mu_run_test(test_create_flow_entry);
    //mu_run_test(test_add_flow_entry);
    return NULL;
}

RUN_TESTS(all_tests);
 
